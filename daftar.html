<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Daftar Surat Dinas</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    body {
      background: url('bgtk.jpeg') no-repeat center center fixed;
      background-size: cover;
      height: 100vh;
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      color: white;
    }

    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.4);
      z-index: 0;
    }

    header, footer {
      background-color: rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      padding: 1rem 2rem;
      position: relative;
      z-index: 1;
      color: white;
      text-align: center;
    }

    nav ul {
      list-style: none;
      display: flex;
      justify-content: center;
      gap: 12px;
      flex-wrap: wrap;
      margin: 1rem 0 0;
      padding: 0;
    }

    nav ul li a {
      text-decoration: none;
      font-weight: bold;
      color: white;
      padding: 8px 16px;
      border-radius: 5px;
      transition: all 0.3s ease-in-out;
    }

    nav ul li a:hover,
    nav ul li a.active {
      background-color: #2a5298;
      color: white;
    }

    nav ul li a.login-button {
      background-color: #2a5298;
    }

    main {
      position: relative;
      z-index: 1;
      background-color: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(15px);
      -webkit-backdrop-filter: blur(15px);
      max-width: 960px;
      margin: 2rem auto;
      padding: 2rem;
      border-radius: 1rem;
      box-shadow: 0 0 20px rgba(0,0,0,0.3);
    }

    h3 {
      border-bottom: 2px solid #ffffffcc;
      padding-bottom: 0.3rem;
      margin-bottom: 1.5rem;
    }

    .form-control, .form-select {
      background-color: rgba(255, 255, 255, 0.1);
      color: white;
      border: 1px solid #ccc;
    }

    .form-control::placeholder {
      color: #eee;
    }

    .form-select option {
      background-color: #2a2a2a;
      color: white;
    }

    .form-select:invalid {
      color: #bbb;
    }

    .assignment-item {
      border: 1px solid #ffffff33;
      background: rgba(255, 255, 255, 0.1);
      padding: 1rem;
      border-radius: 8px;
      margin-bottom: 1rem;
    }

    .assignment-item a {
      color: #aee3ff;
      text-decoration: underline;
    }

    footer {
      margin-top: 2rem;
      font-size: 0.9rem;
    }

    footer a {
      color: #aee3ff;
      text-decoration: none;
    }

    footer a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
<div class="overlay"></div>

<header>
  <div class="logo">
    <img src="logo.png" alt="Logo Instansi" style="height:40px; vertical-align: middle;">
    <span style="font-size: 1.5rem; font-weight: 700;">Portal Surat Kepegawaian</span>
  </div>
  <h1 class="h5 mt-2">Portal Informasi Daftar Surat Kepegawaian</h1>
  <nav>
    <ul>
      <li><a href="user.html">Beranda</a></li>
      <li><a href="daftar.html" class="active">Daftar Surat</a></li>
      <li><a href="pencarian.html">Pencarian</a></li>
      <li><a href="kontak.html">Kontak</a></li>
      <li><a href="profile.html">Profil</a></li>
      <li><a href="logout.php">Logout</a></li>
    </ul>
  </nav>
</header>

<main>
  <section>
    <h3>Tambah Surat Dinas</h3>
    <form id="assignment-form" enctype="multipart/form-data">
      <div class="mb-3">
        <label for="user-name" class="form-label">Nama</label>
        <input type="text" id="user-name" class="form-control" required />
      </div>
      <div class="mb-3">
        <label for="user-position" class="form-label">Jabatan</label>
        <input type="text" id="user-position" class="form-control" required />
      </div>
      <div class="mb-3">
        <label for="start-date" class="form-label">Tanggal Mulai</label>
        <input type="date" id="start-date" class="form-control" required />
      </div>
      <div class="mb-3">
        <label for="start-time" class="form-label">Waktu Mulai</label>
        <input type="time" id="start-time" class="form-control" required />
      </div>
      <div class="mb-3">
        <label for="end-date" class="form-label">Sampai Kapan</label>
        <input type="date" id="end-date" class="form-control" required />
      </div>
      <div class="mb-3">
        <label for="place" class="form-label">Tempat</label>
        <input type="text" id="place" class="form-control" required />
      </div>
      <div class="mb-3">
        <label for="status" class="form-label">Status</label>
        <select id="status" class="form-select" required>
          <option disabled selected value="">Pilih status</option>
          <option>Dalam Kantor</option>
          <option>Dinas Keluar</option>
        </select>
      </div>
      <div class="mb-3">
        <label for="kategori" class="form-label">Kategori Surat</label>
        <select id="kategori" class="form-select" required>
          <option disabled selected value="">Pilih kategori</option>
          <option>Surat Keputusan</option>
          <option>Surat Edaran</option>
          <option>Pengumuman</option>
          <option>Instruksi</option>
          <option>Pedoman</option>
          <option>Surat Tugas</option>
          <option>Surat Dinas</option>
        </select>
      </div>
      <div class="mb-3">
        <label for="file-upload" class="form-label">Upload File Surat (PDF)</label>
        <input type="file" id="file-upload" class="form-control" accept="application/pdf" required />
      </div>
      <button type="submit" class="btn btn-primary w-100">Tambah Surat Dinas</button>
    </form>
  </section>

  <section class="mt-5">
    <h3>Daftar Surat Dinas</h3>
    <div id="assignments-container"></div>
    <div id="arsip-container" class="mt-4"></div>
  </section>
</main>

<footer>
  <p>&copy; 2023 Nama Instansi. Semua hak dilindungi.</p>
  <a href="https://www.instansi-utama.go.id" target="_blank">Website Utama Instansi</a> |
  <a href="https://www.sistem-hr.go.id" target="_blank">Sistem HR Lainnya</a>
</footer>

<script>
  const form = document.getElementById('assignment-form');
  const container = document.getElementById('assignments-container');

  let currentUser = localStorage.getItem('userName') || '';

  form.addEventListener('submit', async function(e) {
    e.preventDefault();
    const nama = document.getElementById('user-name').value.trim();
    const jabatan = document.getElementById('user-position').value.trim();
    const mulai = document.getElementById('start-date').value;
    const waktu = document.getElementById('start-time').value;
    const selesai = document.getElementById('end-date').value;
    const tempat = document.getElementById('place').value.trim();
    const status = document.getElementById('status').value;
    const kategori = document.getElementById('kategori').value;
    const fileInput = document.getElementById('file-upload');
    const dinas = 'User'; // Atur sesuai login jika ada
    if (!nama || !jabatan || !mulai || !waktu || !selesai || !tempat || !status || !kategori || !fileInput.files[0]) {
      alert('Semua field wajib diisi!');
      return;
    }
    const formData = new FormData();
    formData.append('nama', nama);
    formData.append('jabatan', jabatan);
    formData.append('mulai', mulai);
    formData.append('waktu', waktu);
    formData.append('selesai', selesai);
    formData.append('tempat', tempat);
    formData.append('status', status);
    formData.append('kategori', kategori);
    formData.append('file', fileInput.files[0]);
    formData.append('dinas', dinas);
    const res = await fetch('pegawai_create.php', {
      method: 'POST',
      body: formData
    });
    const data = await res.json();
    if (data.success) {
      form.reset();
      renderAssignments();
    } else {
      alert(data.message || 'Gagal mengunggah surat dinas!');
    }
  });

  async function renderAssignments() {
    const res = await fetch('pegawai_read.php');
    const data = await res.json();
    container.innerHTML = '';
    data.forEach(item => {
      const fileLink = item.file ? `<a href='uploads/${item.file}' target='_blank'>Lihat/Unduh File</a>` : '';
      const div = document.createElement('div');
      div.className = 'assignment-item';
      div.innerHTML = `
        <div><strong>Nama:</strong> ${item.nama}</div>
        <div><strong>Jabatan:</strong> ${item.jabatan || '-'}</div>
        <div><strong>Jenis:</strong> ${item.kategori || '-'}</div>
        <div><strong>Tanggal Mulai:</strong> ${item.mulai}</div>
        <div><strong>Waktu Mulai:</strong> ${item.waktu || '-'}</div>
        <div><strong>Tanggal Selesai:</strong> ${item.selesai}</div>
        <div><strong>Tempat:</strong> ${item.tempat || '-'}</div>
        <div><strong>Status:</strong> ${item.status === 'aktif' ? 'Aktif / Sedang Dinas' : 'Selesai'}</div>
        <div>${fileLink}</div>
      `;
      container.appendChild(div);
    });
  }
  renderAssignments();
</script>

</body>
</html>
