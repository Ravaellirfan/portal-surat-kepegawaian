<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Input Data Pegawai</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />
  <style>
    body {
      background: url('bgtk.jpeg') no-repeat center center fixed;
      background-size: cover;
      font-family: 'Segoe UI', sans-serif;
      min-height: 100vh;
      margin: 0;
      padding: 40px 20px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      bottom: 0;
      right: 0;
      background: rgba(0, 0, 0, 0.3);
      z-index: 0;
    }

    .container-glass {
      position: relative;
      z-index: 1;
      width: 100%;
      max-width: 1100px;
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(15px);
      border-radius: 20px;
      padding: 40px;
      color: #fff;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
      animation: fadeIn 1s ease;
    }

    @keyframes fadeIn {
      from { transform: translateY(20px); opacity: 0; }
      to   { transform: translateY(0); opacity: 1; }
    }

    h1 {
      font-weight: 700;
      margin-bottom: 30px;
      text-align: center;
    }

    .form-control, .form-select {
      border-radius: 10px;
      background-color: rgba(255, 255, 255, 0.1);
      color: #fff;
    }

    .form-control::placeholder {
      color: #eee;
    }

    .form-control:focus, .form-select:focus {
      background-color: rgba(255, 255, 255, 0.15);
      color: #fff;
    }

    table {
      background-color: rgba(255, 255, 255, 0.2);
      color: #fff;
    }

    table th, table td {
      vertical-align: middle;
    }

    .btn-primary, .btn-danger {
      border-radius: 10px;
    }

    .btn-secondary {
      background-color: rgba(255, 255, 255, 0.2);
      color: #fff;
      border: none;
      transition: 0.3s;
    }

    .btn-secondary:hover {
      background-color: rgba(255, 255, 255, 0.35);
    }

    @media (max-width: 768px) {
      .container-glass {
        padding: 20px;
      }

      .form-control, .form-select {
        font-size: 14px;
      }

      h1 {
        font-size: 24px;
      }
    }
  </style>
</head>
<body>
  <div class="overlay"></div>
  <div class="container-glass">
    <h1 class="mb-4 text-center"><i class="bi bi-person-vcard-fill"></i> Input Data Pegawai</h1>
    <div class="text-center mb-4">
      <a href="admin.html" class="btn btn-secondary"><i class="bi bi-arrow-left"></i> Kembali ke Dashboard</a>
    </div>
    <form id="pegawai-form" class="mb-4 p-4 shadow-lg rounded-4 bg-white bg-opacity-75 border border-2 border-primary" enctype="multipart/form-data" style="backdrop-filter: blur(6px); max-width:500px; margin:auto;">
      <div class="mb-3">
        <label for="nama" class="form-label fw-semibold text-dark">Nama Pegawai</label>
        <input type="text" id="nama" class="form-control text-dark bg-white" placeholder="Masukkan nama pegawai" required />
      </div>
      <div class="mb-3">
        <label for="jabatan" class="form-label fw-semibold text-dark">Jabatan</label>
        <input type="text" id="jabatan" class="form-control text-dark bg-white" placeholder="Masukkan jabatan" required />
      </div>
      <div class="mb-3">
        <label for="mulai" class="form-label fw-semibold text-dark">Tanggal Mulai</label>
        <input type="date" id="mulai" class="form-control text-dark bg-white" placeholder="Pilih tanggal mulai" required />
      </div>
      <div class="mb-3">
        <label for="waktu" class="form-label fw-semibold text-dark">Waktu Mulai</label>
        <input type="time" id="waktu" class="form-control text-dark bg-white" placeholder="Pilih waktu mulai" required />
      </div>
      <div class="mb-3">
        <label for="selesai" class="form-label fw-semibold text-dark">Tanggal Selesai</label>
        <input type="date" id="selesai" class="form-control text-dark bg-white" placeholder="Pilih tanggal selesai" required />
      </div>
      <div class="mb-3">
        <label for="tempat" class="form-label fw-semibold text-dark">Tempat</label>
        <input type="text" id="tempat" class="form-control text-dark bg-white" placeholder="Masukkan tempat dinas" required />
      </div>
      <div class="mb-3">
        <label for="status" class="form-label fw-semibold text-dark">Status</label>
        <select id="status" class="form-select text-dark bg-white" required>
          <option value="" disabled selected hidden>Pilih status dinas</option>
          <option value="aktif">Aktif / Sedang Dinas</option>
          <option value="selesai">Selesai</option>
        </select>
      </div>
      <div class="mb-3">
        <label for="kategori" class="form-label fw-semibold text-dark">Kategori</label>
        <select id="kategori" class="form-select text-dark bg-white" required>
          <option value="" disabled selected hidden>Pilih kategori surat</option>
          <option>Surat Keputusan</option>
          <option>Surat Edaran</option>
          <option>Pengumuman</option>
          <option>Instruksi</option>
          <option>Pedoman</option>
          <option>Surat Tugas</option>
          <option>Surat Dinas</option>
        </select>
      </div>
      <div class="mb-3">
        <label for="dinas" class="form-label fw-semibold text-dark">Dinas</label>
        <select id="dinas" class="form-select text-dark bg-white" required>
          <option value="" disabled selected hidden>Pilih jenis dinas</option>
          <option value="Dalam Kantor">Dalam Kantor</option>
          <option value="Dinas Luar">Dinas Luar</option>
        </select>
      </div>
      <div class="mb-3">
        <label for="file-upload" class="form-label fw-semibold text-dark">Upload File (PDF)</label>
        <input type="file" id="file-upload" class="form-control text-dark bg-white" accept="application/pdf" placeholder="Unggah file PDF surat dinas" />
      </div>
      <div class="mb-2 d-grid">
        <button type="submit" class="btn btn-primary w-100 shadow"><i class="bi bi-plus-circle"></i> Tambah Data</button>
      </div>
    </form>
    <div class="table-responsive">
      <table class="table table-bordered table-striped text-center align-middle bg-white text-dark" style="min-width:1200px;">
        <thead class="table-primary">
          <tr>
            <th style="width:10%">Nama</th>
            <th style="width:10%">Jabatan</th>
            <th style="width:8%">Tgl Mulai</th>
            <th style="width:8%">Waktu</th>
            <th style="width:8%">Tgl Selesai</th>
            <th style="width:10%">Tempat</th>
            <th style="width:8%">Status</th>
            <th style="width:10%">Kategori</th>
            <th style="width:8%">Dinas</th>
            <th style="width:10%">File</th>
            <th style="width:10%">Aksi</th>
          </tr>
        </thead>
        <tbody id="pegawai-table">
          <!-- Data dinamis -->
        </tbody>
      </table>
      <button class="btn btn-success mt-2" onclick="exportPegawaiExcel()"><i class="bi bi-file-earmark-excel"></i> Unduh Excel</button>
    </div>
  </div>

  <script>
    const form = document.getElementById('pegawai-form');
    const table = document.getElementById('pegawai-table');
    const tugasList = [];

    form.addEventListener('submit', async function (e) {
      e.preventDefault();
      const nama = document.getElementById('nama').value.trim();
      const jabatan = document.getElementById('jabatan').value.trim();
      const mulai = document.getElementById('mulai').value;
      const waktu = document.getElementById('waktu').value;
      const selesai = document.getElementById('selesai').value;
      const tempat = document.getElementById('tempat').value.trim();
      const status = document.getElementById('status').value;
      const kategori = document.getElementById('kategori').value;
      const dinas = document.getElementById('dinas').value;
      const fileInput = document.getElementById('file-upload');
      if (!nama || !jabatan || !mulai || !waktu || !selesai || !tempat || !status || !kategori || !dinas) {
        alert('Semua field wajib diisi!');
        return;
      }
      const formData = new FormData();
      formData.append('nama', nama);
      formData.append('jabatan', jabatan);
      formData.append('mulai', mulai);
      formData.append('waktu', waktu);
      formData.append('selesai', selesai);
      formData.append('tempat', tempat);
      formData.append('status', status);
      formData.append('kategori', kategori);
      formData.append('dinas', dinas);
      if (fileInput.files[0]) formData.append('file', fileInput.files[0]);
      const res = await fetch('pegawai_create.php', {
        method: 'POST',
        body: formData
      });
      const data = await res.json();
      if (data.success) {
        form.reset();
        loadPegawai();
      } else {
        alert(data.message || 'Gagal menambah data pegawai!');
      }
    });

    async function loadPegawai() {
      const res = await fetch('pegawai_read.php');
      const data = await res.json();
      table.innerHTML = '';
      data.forEach(pegawai => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${pegawai.nama}</td>
          <td>${pegawai.jabatan}</td>
          <td>${pegawai.mulai}</td>
          <td>${pegawai.waktu || '-'}</td>
          <td>${pegawai.selesai}</td>
          <td>${pegawai.tempat}</td>
          <td>${pegawai.status === 'aktif' ? 'Aktif / Sedang Dinas' : 'Selesai'}</td>
          <td>${pegawai.kategori || '-'}</td>
          <td>${pegawai.dinas}</td>
          <td>${pegawai.file ? `<a href='uploads/${pegawai.file}' target='_blank'>Unduh</a>` : '-'}</td>
          <td>
            <button class="btn btn-warning btn-sm mb-1" onclick="editPegawai('${pegawai.id}')"><i class='bi bi-pencil'></i></button>
            <button class="btn btn-danger btn-sm mb-1" onclick="hapusPegawai('${pegawai.id}')"><i class='bi bi-trash'></i></button><br>
            <input type='checkbox' ${pegawai.status==='selesai'?'checked':''} onchange='setSelesai(${pegawai.id},this.checked)'> Selesai
          </td>
        `;
        table.appendChild(tr);
      });
    }
    loadPegawai();

    async function hapusPegawai(id) {
      if (!confirm('Yakin hapus data ini?')) return;
      const res = await fetch('pegawai_delete.php', {
        method: 'POST',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body: `id=${id}`
      });
      const data = await res.json();
      if (data.success) loadPegawai();
      else alert('Gagal menghapus!');
    }

    function editPegawai(id) {
      const namaBaru = prompt('Edit nama pegawai:');
      if (!namaBaru) return;
      fetch('pegawai_edit.php', {
        method: 'POST',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body: `id=${id}&nama=${encodeURIComponent(namaBaru)}`
      }).then(res => res.json()).then(data => {
        if (data.success) loadPegawai();
        else alert('Gagal edit data!');
      });
    }

    function exportPegawaiExcel() {
      window.location = 'pegawai_export_excel.php';
    }

    function setSelesai(id, selesai) {
      fetch('pegawai_set_selesai.php', {
        method: 'POST',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body: `id=${id}&selesai=${selesai ? 'selesai' : 'aktif'}`
      }).then(res => res.json()).then(data => {
        if (data.success) loadPegawai();
        else alert('Gagal mengubah status!');
      });
    }
  </script>
</body>
</html>
